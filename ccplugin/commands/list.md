---
description: 列出所有 memory 条目的索引摘要，支持时间过滤，显示分层状态
argument-hint: [time:范围] [project:路径]
allowed-tools: Bash, Read, Glob, Grep
---

# LongMemory List Command

列出所有 memory 条目的索引摘要，显示分层状态和统计信息。

## 执行步骤

### 1. 解析参数
从用户输入中提取过滤参数：
- `time:` 时间范围过滤（如 time:7d, time:2026-02, time:2026-01-01..2026-01-31）
- `project:` 项目路径过滤（如 project:/api）

### 2. 优先读取索引
使用 Read 工具读取 `docs/memory/index.json`：
- 索引存在：直接从 `entries` 数组构建表格，使用 `layer`、`title`、`summary`、`tags`、`sizeBytes` 字段
- 索引不存在：回退到兼容模式（步骤 3）

### 3. 兼容模式（索引不存在时）
使用 Bash 工具执行：
```bash
ls -1 docs/memory/*.md 2>/dev/null | grep -v index.json
```
对每个文件使用 Read 工具读取前 10 行，提取：
- 第一行 `#` 标题
- frontmatter 中的 `layer` 字段（默认 L0）
- 第一段文本作为摘要

### 4. 应用过滤
根据参数过滤条目：
- `time:` 参数：解析时间范围，过滤文件名中的日期
  - `7d` → 最近 7 天
  - `2026-02` → 2026 年 2 月
  - `2026-01-01..2026-01-31` → 日期区间
- `project:` 参数：匹配 tags 中包含项目路径的条目

### 5. 统计分层信息
统计各层级数量：
- L0: 活跃层（未压缩）
- L1: 压缩层
- L2: 归档层
计算总大小（KB）

### 6. 输出表格
按时间倒序排列，输出格式：
```
Memory 索引 (共 N 条 | L0: X  L1: Y  L2: Z | 总大小: XXX KB)

日期         | 层级 | 标题                    | 摘要                         | 文件
------------|------|------------------------|------------------------------|---------------------------
2026-02-14  | L0   | 实现用户认证功能          | 完成 JWT 认证模块             | 2026-02-14-auth-impl.md
2026-02-07  | L1   | API 设计评审             | 评审并确定了 v2 API 接口       | 2026-02-07-api-design.md
2026-01-10  | L2   | 数据库迁移方案            | 设计了从 MySQL 到 PostgreSQL  | 2026-01-10-db-migration.md
```

### 7. 空结果处理
如果没有找到任何条目，输出：
```
未找到 memory 条目。

使用 /longmemory:save 创建第一条记录。
```

## 注意事项
- 必须使用 Bash ls 命令扫描目录（Windows 兼容性）
- 优先使用索引加速，回退到文件扫描
- 摘要截断到 50 字符，避免表格过宽
- 层级标记使用颜色或符号区分（L0 正常，L1 压缩，L2 归档）
